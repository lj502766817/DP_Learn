### YOLO系列笔记

深度学习的经典检测方法,通常分为两类:

* one stage:

  yolo系列

  通常是使用一个特征提取网络,然后根据网络提取的特征,直接预测目标的位置.

  one stage的优势是速度很快,适合一些实时的检测任务.缺点就是相对来说检测的精度不是那么高.

* two stage:

  Faster-Rcnn,Mask-Rcnn系列

  与one stage不同的是,two stage是先用一个网络提取目标的候选框,然后根据候选区,再用CNN网络来分类.

  因为涉及到了两个阶段,因此,two stage的FPS通常较低,但是相对来说检测的精度就上来了.

一些名词解释:

* **TP**:检索到正类并判定为了正类
* **FP**:检索到负类并判定为正类
* **FN**:检索到正类并判定成负类
* **TN**:检索到负类并判定成负类
* **精度(precision)**: $TP\over{TP+FP}$ ,即在所有判定为正类结果中,真正为正类的比例.
* **召回率(recall)**: $TP\over{TP+FN}$ ,即在所有的正类中,被检索到的比例.
  *(精度和召回率通常是互斥的)*
* **IOU(Intersection over Union)**: 检测框区域与真实框区域的交集大小比上检测框区域与真实框区域的并集大小
* **mAP**:AP指的就是精度和召回率,mAP就是对精度和召回率的平均结果.计算方式为:针对检测的IOU,我们可以设置不同的置信度,而这些置信度产生的结果又是一对对精度和召回率的元组.然后就可以画出精度和召回率的PR曲线图,这个曲线图下的面积就是mAP值.

#### YOLO-V1

YOLO-V1版本提取特征的网络结构很简单,就是一个CNN的网络没什么说的.

V1版本的重点在于最后的输出层.经过前面的CNN网络去提取特征,得到一个(1470,1)的特征向量.然后把这个特征向量reshape成一个(7,7,30)的特征图,这个特征图就是重点.

前面的7\*7表示,最后的结果是把原始图像切割成了7\*7的网格.然后由于V1版本是默认对每个检测目标都有两个候选框,因此后面的30,先拆分成5+5+20.这里面的5表示在一个候选框中的中心点(x,y),长宽(w,h),以及区域的置信度c的值,所以有两个5,然后做的是20分类,因此后面的20就表示20分类的概率值.

##### 损失函数

V1版本最关键的点就是定义了YOLO目标检测的损失函数

YOLO的损失函数有三个部分:

![YOLO损失函数](https://user-images.githubusercontent.com/28779173/196934339-d9177969-73a5-41a3-bc7e-c2ac8885d8af.jpg)


* 第一个是位置误差部分:就是每个单元格以及每个候选框预测值的中心点,长宽与标签值的差异

* 第二个是置信度误差部分:就是预测值与标签值置信度的差异,不过需要注意的一点是,在置信度损失函数部分,因为在一张图中,检测目标以外的区域可能是有很大的,那么为了避免非检测目标对检测目标损失函数造成太大的干扰,因此需要在对非检测目标区域的置信度损失函数加一个 $\lambda$ 的权重控制

* 第三个是分类误差部分,就是一个交叉熵损失函数就行了

这三个部分合起来就是YOLO的损失函数.神经网络通过第一部分来修正每次学习的位置误差,通过第二分部来修正置信度误差,第三部分来修正分类误差

##### 非极大值抑制
因为对一个目标的检测,有可能有很多到的中心点以及候选框,那么我们需要选出一个最优的候选框.这个时候需要进行非极大值抑制,只选IOU最大的那个

##### 总结
YOLO-V1版本的属于YOLO系列的基础
它的优势在于:整个网络很简单,这样就使得检测速度很快.但是这样也带来了弊端:每个Cell只能检测到一个类别,如果有重叠就没有办法了,并且小物体的检测效果一般,长宽比的选择也很少.

#### YOLO-V2

鉴于YOLO-V1版本的缺陷.YOLO-V2在网络结构,先验候选框等方面进行了优化.

##### 网络结构改善

* 去掉Dropout层,改成Conv层和BN层的结合,一层Conv层连一层BN层,归一化后,收敛相对容易.最后效果有2%mAP的提升

* 训练时除开原本V1版本那样用224\*224的分辨率之外,还额外使用了10次448\*448的分辨率进行微调,增强了模型的泛化能力,最后效果有4%mAP的提升

* 去掉了FC层,V1版本再最后输出的时候,先把特征图做成特征向量,然后经过FC,然后又转回特征图.这种操作很繁琐,而且FC层的参数很多.V2版本使用了5次降采样Maxpool和1\*1的Conv来替代.相比较来说,这样参数会小很多,那么模型的速度也会更快

  

##### 先验候选框

V1的候选框是默认的2种,而且大小是常规预置的.这种可能并不能适合自己任务的数据集.
![YOLO-V3结构图](https://user-images.githubusercontent.com/28779173/197393933-fa8dc500-d6cf-4942-8d24-a8ee3e0e8299.jpg)

